<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution of Trust - Interactive Game</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ù</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>Evolution of Trust</h1>
            <p class="subtitle">An interactive guide to the game theory of cooperation</p>
        </header>

        <main id="game-container">
            <!-- Tutorial Section -->
            <section id="tutorial" class="game-section active">
                <h2>Understanding the Game</h2>

                <p class="concept-intro">
                    Explore one of the most fascinating puzzles in game theory: <strong>when should you trust, and when should you betray?</strong>
                </p>

                <div class="concept-grid">
                    <div class="concept-card">
                        <span class="concept-card-icon">‚öñÔ∏è</span>
                        <h3>The Dilemma</h3>
                        <p>Two players independently choose: cooperate or defect. Cooperation benefits both, but defection offers a higher personal payoff‚Äîat your partner's expense. The catch? If both defect, both lose.</p>
                    </div>

                    <div class="concept-card">
                        <span class="concept-card-icon">üíé</span>
                        <h3>The Payoffs</h3>
                        <p>Mutual cooperation earns +3 each. Mutual defection earns only +1 each. But if you defect while they cooperate, you get +5 and they get nothing. The temptation to betray is strong‚Äîbut risky.</p>
                    </div>

                    <div class="concept-card">
                        <span class="concept-card-icon">üåç</span>
                        <h3>Why It Matters</h3>
                        <p>This simple dynamic appears everywhere: climate agreements, business partnerships, international relations, and everyday social interactions. It's the fundamental tension between individual gain and collective good.</p>
                    </div>

                    <div class="concept-card">
                        <span class="concept-card-icon">üîÑ</span>
                        <h3>Repeated Interactions</h3>
                        <p>When the game repeats, everything changes. Strategies emerge: some always cooperate, others always defect, some retaliate when betrayed, others forgive. Reputation matters. History matters.</p>
                    </div>

                    <div class="concept-card">
                        <span class="concept-card-icon">üé≠</span>
                        <h3>Competing Strategies</h3>
                        <p>Meet different AI opponents: the eternal optimist who always trusts, the cynic who never does, the reciprocator who mirrors your moves, and the grudge-holder who never forgives. Each has strengths and weaknesses.</p>
                    </div>

                    <div class="concept-card">
                        <span class="concept-card-icon">üß¨</span>
                        <h3>Evolution in Action</h3>
                        <p>Watch strategies compete in a living population. Successful strategies reproduce, unsuccessful ones die out. Discover which approaches thrive, which collapse, and why cooperation can emerge‚Äîor fail.</p>
                    </div>
                </div>

                <div class="key-insight">
                    <div class="key-insight-label">The Central Question</div>
                    <div class="key-insight-text">When does cooperation emerge, and when does it collapse?</div>
                </div>

                <div class="payoff-matrix">
                    <h3>Payoff Matrix</h3>
                    <table>
                        <tr>
                            <th></th>
                            <th>Opponent Cooperates</th>
                            <th>Opponent Defects</th>
                        </tr>
                        <tr>
                            <th>You Cooperate</th>
                            <td class="both-cooperate">+3 / +3</td>
                            <td class="sucker">0 / +5</td>
                        </tr>
                        <tr>
                            <th>You Defect</th>
                            <td class="temptation">+5 / 0</td>
                            <td class="both-defect">+1 / +1</td>
                        </tr>
                    </table>
                </div>

                <div class="landing-options">
                    <h3>Choose Your Experience</h3>
                    <div class="option-cards">
                        <div class="option-card">
                            <div class="option-emoji">üéÆ</div>
                            <h4>Play the Game</h4>
                            <p>Face different AI strategies and learn their patterns</p>
                            <button class="btn-primary" onclick="gameController.startPlayground()">Start Playing</button>
                        </div>
                        <div class="option-card">
                            <div class="option-emoji">üß¨</div>
                            <h4>Evolution Simulator</h4>
                            <p>Watch strategies compete and evolve over generations</p>
                            <button class="btn-primary" onclick="gameController.startEvolutionFromMenu()">Launch Simulator</button>
                        </div>
                        <div class="option-card">
                            <div class="option-emoji">üî¨</div>
                            <h4>Sandbox Mode</h4>
                            <p>Experiment with custom parameters and conditions</p>
                            <button class="btn-primary" onclick="gameController.startSandbox()">Open Sandbox</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Playground Section -->
            <section id="playground" class="game-section">
                <h2>Meet the Strategies</h2>
                <div class="narrative-text">
                    <p id="strategy-description">Let's play against different strategies...</p>
                </div>

                <div class="game-board">
                    <div class="player-area">
                        <h3>You</h3>
                        <div id="player-visual" class="agent-visual"></div>
                        <div class="score">Score: <span id="player-score">0</span></div>
                    </div>

                    <div class="vs-area">
                        <div id="round-info">Round <span id="current-round">1</span> / <span id="total-rounds">7</span></div>
                        <div id="last-result"></div>
                    </div>

                    <div class="opponent-area">
                        <h3 id="opponent-name">Opponent</h3>
                        <div id="opponent-visual" class="agent-visual"></div>
                        <div class="score">Score: <span id="opponent-score">0</span></div>
                    </div>
                </div>

                <div class="history-container">
                    <h4>History</h4>
                    <div id="history-display"></div>
                </div>

                <div class="action-buttons">
                    <button id="cooperate-btn" class="btn-cooperate" onclick="gameController.playerMove('cooperate')">
                        ü§ù Cooperate
                    </button>
                    <button id="defect-btn" class="btn-defect" onclick="gameController.playerMove('defect')">
                        üíî Defect
                    </button>
                </div>

                <button id="next-strategy-btn" class="btn-secondary" style="display: none;" onclick="gameController.nextStrategy()">
                    Next Strategy
                </button>
            </section>

            <!-- Evolution Section -->
            <section id="evolution" class="game-section">
                <h2>Evolution Simulation</h2>
                <div class="narrative-text">
                    <p>Now let's see what happens when these strategies compete in a population...</p>
                    <p>Each generation, successful strategies reproduce and unsuccessful ones die out.</p>
                </div>

                <div class="evolution-controls">
                    <div class="evolution-stats">
                        <div>Generation: <span id="generation">0</span> / 50</div>
                        <div>Population: <span id="population-size">100</span></div>
                    </div>
                    <button id="start-evolution-btn" class="btn-primary" onclick="gameController.startEvolution()">
                        Start Evolution
                    </button>
                    <button id="pause-evolution-btn" class="btn-secondary" style="display: none;" onclick="gameController.pauseEvolution()">
                        Pause
                    </button>
                    <button id="reset-evolution-btn" class="btn-secondary" onclick="gameController.resetEvolution()">
                        Reset
                    </button>
                    <button id="toggle-details-btn" class="btn-secondary" onclick="gameController.toggleEvolutionDetails()">
                        üìä Show Details
                    </button>
                </div>

                <div id="evolution-canvas-container" class="hidden">
                    <div id="evolution-details" class="evolution-log"></div>
                </div>

                <div id="population-chart"></div>

                <button class="btn-primary" onclick="gameController.startSandbox()">Try Sandbox Mode</button>
            </section>

            <!-- Sandbox Section -->
            <section id="sandbox" class="game-section">
                <h2>Sandbox Mode</h2>
                <div class="narrative-text">
                    <p>Experiment with different parameters to see how they shape the evolution of cooperation. Each setting creates a different environment where strategies must adapt and compete.</p>
                </div>

                <div class="sandbox-controls">
                    <div class="control-group">
                        <label>
                            <strong>Population Size: <span id="sandbox-pop-value">100</span></strong>
                            <span class="param-description">Total number of agents competing in the simulation. Larger populations create more diverse ecosystems but take longer to evolve.</span>
                        </label>
                        <input type="range" id="sandbox-population" min="20" max="200" value="100" step="10">
                    </div>
                    <div class="control-group">
                        <label>
                            <strong>Rounds per Match: <span id="sandbox-rounds-value">7</span></strong>
                            <span class="param-description">How many times each pair of agents interact. More rounds allow complex strategies like Tit for Tat to prove their worth, while fewer rounds favor simple strategies.</span>
                        </label>
                        <input type="range" id="sandbox-rounds" min="3" max="20" value="7">
                    </div>
                    <div class="control-group">
                        <label>
                            <strong>Mutation Rate: <span id="sandbox-mutation-value">5</span>%</strong>
                            <span class="param-description">Chance that an agent randomly changes strategy when reproducing. Higher rates maintain diversity but disrupt stable populations. Zero creates pure competition.</span>
                        </label>
                        <input type="range" id="sandbox-mutation" min="0" max="20" value="5">
                    </div>
                    <div class="control-group">
                        <label>
                            <strong>Noise Rate: <span id="sandbox-noise-value">2</span>%</strong>
                            <span class="param-description">Probability that an agent makes a mistake (cooperates when they meant to defect, or vice versa). Higher noise makes cooperation harder and punishes unforgiving strategies.</span>
                        </label>
                        <input type="range" id="sandbox-noise" min="0" max="10" value="2">
                    </div>
                </div>

                <div class="sandbox-buttons">
                    <button class="btn-primary" onclick="gameController.runSandboxSimulation()">Run Simulation</button>
                    <button class="btn-secondary" onclick="gameController.resetSandbox()">Reset</button>
                </div>

                <div class="sandbox-stats">
                    <div>Generation: <span id="sandbox-generation">0</span> / 50</div>
                    <div>Population: <span id="sandbox-population-size">100</span></div>
                    <div>Status: <span id="sandbox-status">Ready</span></div>
                </div>

                <div id="sandbox-population-chart"></div>

                <div id="sandbox-results"></div>
            </section>
        </main>

        <footer>
            <p>Inspired by Nicky Case's "Evolution of Trust" | Built with game theory and love</p>
        </footer>
    </div>

    <script src="game.js"></script>
    <script src="app.js"></script>
</body>
</html>
